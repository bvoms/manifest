<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üî• NewMe</title>

<link rel="manifest" href="manifest.json">

<style>
:root{
  --bg:#0e0e11;
  --card:#16161d;
  --text:#eaeaf0;
  --muted:#9a9aa3;
  --accent:#5cff9d;
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui;background:var(--bg);color:var(--text)}
header{padding:20px;text-align:center;font-size:24px;font-weight:700}
section{margin:16px;padding:16px;background:var(--card);border-radius:12px}
h2{margin-top:0}
.small{font-size:13px;color:var(--muted)}
.progress{height:10px;background:#000;border-radius:6px;overflow:hidden}
.fill{height:100%;background:var(--accent);width:0%}
button{
  padding:8px 12px;margin:4px 4px 0 0;
  background:transparent;border:1px solid var(--accent);
  color:var(--accent);border-radius:8px
}
button.active{background:var(--accent);color:#000}
label{display:flex;gap:10px;margin:6px 0;align-items:flex-start}
input,select{
  background:#101015;border:1px solid #333;
  color:var(--text);border-radius:6px;padding:4px 6px
}
details{background:#101015;padding:8px;border-radius:8px;margin:6px 0}
summary{cursor:pointer;color:var(--accent);font-weight:600}
pre{white-space:pre-wrap;font-family:inherit;font-size:14px;line-height:1.4}
img{max-width:100%;border-radius:8px;margin-top:6px}
.meal-title{font-weight:600}
.food-input {
  width: 70px;
  padding: 6px 8px;
  background: linear-gradient(180deg, #14141a, #0e0e11);
  border: 1px solid #2a2a35;
  border-radius: 10px;
  color: #eaeaf0;
  font-size: 14px;
  outline: none;
  transition: 0.2s;
  text-align: center;
}

.food-input:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 2px rgba(92,255,157,0.15);
}

.food-row {
  display: flex;
  align-items: center;
  gap: 10px;
  margin: 6px 0;
}

.food-name {
  min-width: 80px;
  color: var(--muted);
}

.food-rec {
  color: var(--muted);
  font-size: 12px;
}
#advice{
  margin-top:10px;
  padding:8px 10px;
  background:#101015;
  border-left:3px solid var(--accent);
  border-radius:8px;
  font-size:14px;
}
</style>
</head>

<body>

<header>üî• NewMe</header>

<!-- ===== –î–ï–ù–¨ / –°–¢–ê–¢–£–° ===== -->
<section>
  <div class="small" id="dayInfo"></div>
  <div class="small" id="quote"></div>

  <div class="small">–ö–∞–ª–æ—Ä–∏–∏</div>
  <div class="progress"><div class="fill" id="calFill"></div></div>
  <div class="small" id="calText"></div>

  <div class="small">–ë–µ–ª–æ–∫</div>
  <div class="progress"><div class="fill" id="protFill"></div></div>
  <div class="small" id="protText"></div>

  <div class="small">–£–≥–ª–µ–≤–æ–¥—ã</div>
  <div class="progress"><div class="fill" id="carbFill"></div></div>
  <div class="small" id="advice"></div>
  <div class="small" id="carbText"></div>
</section>

<!-- ===== –¢–†–ï–ù–ò–†–û–í–ö–ê ===== -->
<section>
<h2>üèãÔ∏è –°–µ–≥–æ–¥–Ω—è—à–Ω—è—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</h2>
<div id="workout"></div>
</section>

<!-- ===== –ì–ê–†–ù–ò–† ===== -->
<section>
<h2>üçö –ì–∞—Ä–Ω–∏—Ä –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</h2>
<button id="btn-rice" onclick="setSide('rice')">–†–∏—Å</button>
<button id="btn-pasta" onclick="setSide('pasta')">–ú–∞–∫–∞—Ä–æ–Ω—ã</button>
<button id="btn-buckwheat" onclick="setSide('buckwheat')">–ì—Ä–µ—á–∫–∞</button>
</section>

<!-- ===== –ü–ò–¢–ê–ù–ò–ï ===== -->
<section>
<h2>üçΩÔ∏è –ü–∏—Ç–∞–Ω–∏–µ (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è ‚Üí —Ñ–∞–∫—Ç)</h2>
<div id="meals"></div>
</section>

<!-- ===== –í–ï–° / –§–û–¢–û ===== -->
<section>
<h2>‚öñÔ∏è –í–µ—Å –∏ —Ñ–æ—Ç–æ-–ø—Ä–æ–≥—Ä–µ—Å—Å</h2>
<input type="number" id="weightInput" placeholder="–í–µ—Å (–∫–≥)">
<input type="file" accept="image/*" onchange="savePhoto(event)">
<br>
<button onclick="saveWeight()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
<div id="progressHistory"></div>
</section>

<!-- ===== –ù–ï–î–ï–õ–ò ===== -->
<section>
<h2>üìä –ù–µ–¥–µ–ª—å–Ω—ã–µ –æ—Ç—á—ë—Ç—ã</h2>
<div id="weekly"></div>
</section>

<!-- ===== –ù–ê–ü–û–ú–ò–ù–ê–ù–ò–Ø ===== -->
<section>
<h2>üîî –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</h2>
<button onclick="enableReminders()">–í–∫–ª—é—á–∏—Ç—å</button>
<button onclick="disableReminders()">–í—ã–∫–ª—é—á–∏—Ç—å</button>
<div class="small">08:00 ¬∑ 11:00 ¬∑ 14:00 ¬∑ 17:00 ¬∑ 19:00 ¬∑ 21:00</div>
</section>

<!-- ===== –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø ===== -->
<section>
<h2>üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è</h2>
<button onclick="exportData()">–≠–∫—Å–ø–æ—Ä—Ç</button>
<input type="file" id="importFile" hidden onchange="importData(event)">
<button onclick="importFile.click()">–ò–º–ø–æ—Ä—Ç</button>
</section>

<script>
// ==================== –û–°–ù–û–í–ê ====================
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js");
}

const start = localStorage.start || new Date().toISOString();
localStorage.start = start;
const day = Math.floor((Date.now()-new Date(start))/86400000)+1;
dayInfo.innerText = `–î–µ–Ω—å ${day} | –¶–∏–∫–ª ${(day-1)%7+1}`;

const quotes=[
  "–ï–¥–∞ = —Ä–æ—Å—Ç",
  "–°–∏—Å—Ç–µ–º–∞ —Å–∏–ª—å–Ω–µ–µ –º–æ—Ç–∏–≤–∞—Ü–∏–∏",
  "–ù–µ–¥–æ–µ–ª ‚Äî –Ω–µ –≤—ã—Ä–æ—Å",
  "–°–µ–≥–æ–¥–Ω—è —Ç—ã —Å—Ç—Ä–æ–∏—à—å —Ç–µ–ª–æ"
];
const qKey="q"+day;
if(!localStorage[qKey]) localStorage[qKey]=quotes[Math.floor(Math.random()*quotes.length)];
quote.innerText="üß† "+localStorage[qKey];

// ==================== –¢–†–ï–ù–ò–†–û–í–ö–ò ====================
const workouts=[
{
title:"–ì—Ä—É–¥—å + –¢—Ä–∏—Ü–µ–ø—Å",
ex:[
["–û—Ç–∂–∏–º–∞–Ω–∏—è 3√ó15‚Äì20 (4-–π –æ—Ç–∫–∞–∑)","–ö–æ—Ä–ø—É—Å —Ä–æ–≤–Ω—ã–π, –≥—Ä—É–¥—å –∫ –ø–æ–ª—É."],
["–û—Ç–∂–∏–º–∞–Ω–∏—è —Å –Ω–æ–≥–∞–º–∏ 3√ó12‚Äì15","–ù–æ–≥–∏ –≤—ã—à–µ ‚Äî –±–æ–ª—å—à–µ –≤–µ—Ä—Ö –≥—Ä—É–¥–∏."],
["–ú–µ–¥–ª–µ–Ω–Ω—ã–µ –æ—Ç–∂–∏–º–∞–Ω–∏—è 2√ó–º–∞–∫—Å","–û–ø—É—Å–∫–∞–Ω–∏–µ 3 —Å–µ–∫."],
["–£–∑–∫–∏–µ –æ—Ç–∂–∏–º–∞–Ω–∏—è 3√ó12‚Äì15","–õ–æ–∫—Ç–∏ –≤–¥–æ–ª—å –∫–æ—Ä–ø—É—Å–∞."],
["–û–±—Ä–∞—Ç–Ω—ã–µ –æ—Ç–∂–∏–º–∞–Ω–∏—è 3√ó–º–∞–∫—Å","–†–∞–±–æ—Ç–∞–µ—Ç —Ç—Ä–∏—Ü–µ–ø—Å."],
["–§–∏–Ω–∏—à–µ—Ä 30/15 √ó4","30 —Å–µ–∫ —Ä–∞–±–æ—Ç–∞ / 15 —Å–µ–∫ –æ—Ç–¥—ã—Ö."]
]
},
{
title:"–°–ø–∏–Ω–∞ + –ë–∏—Ü–µ–ø—Å",
ex:[
["–¢—è–≥–∞ –ø–æ–ª–æ—Ç–µ–Ω—Ü–∞ 4√ó12‚Äì15","–°–≤–æ–¥–∏ –ª–æ–ø–∞—Ç–∫–∏."],
["–°—É–ø–µ—Ä–º–µ–Ω 3√ó20","–ö–æ–Ω—Ç—Ä–æ–ª—å –ø–æ—è—Å–Ω–∏—Ü—ã."],
["–°–≥–∏–±–∞–Ω–∏—è —Ä—É–∫ 4√ó15‚Äì20","–ë–µ–∑ —Ä–∞—Å–∫–∞—á–∫–∏."],
["–°—Ç–∞—Ç–∏–∫–∞ 90¬∞ 2√ó–º–∞–∫—Å","–î–µ—Ä–∂–∏ –¥–æ –∂–∂–µ–Ω–∏—è."]
]
},
{
title:"–ù–æ–≥–∏",
ex:[
["–ü—Ä–∏—Å–µ–¥ 5√ó20","–ü–æ—Å–ª–µ–¥–Ω–∏–π –¥–æ –æ—Ç–∫–∞–∑–∞."],
["–í—ã–ø–∞–¥—ã 4√ó12/–Ω–æ–≥–∞","–ö–æ–ª–µ–Ω–æ –Ω–∞–∑–∞–¥."],
["–ü—Ä–∏—Å–µ–¥ —Å –ø–∞—É–∑–æ–π 3√ó10","–ü–∞—É–∑–∞ –≤–Ω–∏–∑—É."],
["–Ø–≥–æ–¥–∏—á–Ω—ã–π –º–æ—Å—Ç 4√ó20","–°–∂–∏–º–∞–π —è–≥–æ–¥–∏—Ü—ã."]
]
},
{
title:"–ü–ª–µ—á–∏ + –ü—Ä–µ—Å—Å",
ex:[
["–û—Ç–∂–∏–º–∞–Ω–∏—è —É–≥–æ–ª–∫–æ–º 4√ó–º–∞–∫—Å","–ì–æ–ª–æ–≤–∞ –≤–Ω–∏–∑."],
["–†–∞–∑–≤–µ–¥–µ–Ω–∏—è 4√ó20","–î–æ —É—Ä–æ–≤–Ω—è –ø–ª–µ—á."],
["–°–∫—Ä—É—á–∏–≤–∞–Ω–∏—è 3√ó30","–õ–æ–ø–∞—Ç–∫–∏ –≤–≤–µ—Ä—Ö."],
["–ü–æ–¥—ä—ë–º—ã –Ω–æ–≥ 4√ó–º–∞–∫—Å","–ù–æ–≥–∏ –ø—Ä—è–º—ã–µ."]
]
},
{title:"–§—É–ª–ª–±–æ–¥–∏",ex:[["–û—Ç–∂–∏–º–∞–Ω–∏—è, –ø—Ä–∏—Å–µ–¥, –ø–ª–∞–Ω–∫–∞","–†–∞–±–æ—Ç–∞ –≤—Å–µ–º —Ç–µ–ª–æ–º"]]},
{title:"–û—Ç–¥—ã—Ö",ex:[["–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ","–ü—Ä–æ–≥—É–ª–∫–∞, —Å–æ–Ω"]]},
{title:"–û—Ç–¥—ã—Ö",ex:[["–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ","–ü—Ä–æ–≥—É–ª–∫–∞, —Å–æ–Ω"]]}
];

const w=workouts[(day-1)%7];
let wHTML=`<strong>${w.title}</strong>`;
w.ex.forEach(e=>{
  wHTML+=`
  <div>‚Ä¢ ${e[0]}
    <details><summary>–ö–∞–∫ –¥–µ–ª–∞—Ç—å</summary><pre>${e[1]}</pre></details>
  </div>`;
});
workout.innerHTML=wHTML;

// ==================== –ü–ò–¢–ê–ù–ò–ï ====================
const isTrainDay=(day-1)%7<5;
const TARGETS=isTrainDay?{cal:3200,prot:130,carb:420}:{cal:2800,prot:130,carb:300};

let side=localStorage.side||"rice";
const sides={rice:"—Ä–∏—Å",pasta:"–º–∞–∫–∞—Ä–æ–Ω—ã",buckwheat:"–≥—Ä–µ—á–∫–∞"};
const FOOD_NAMES = {
  rice: "—Ä–∏—Å",
  pasta: "–º–∞–∫–∞—Ä–æ–Ω—ã",
  buckwheat: "–≥—Ä–µ—á–∫–∞",
  chicken: "–∫—É—Ä–∏—Ü–∞",
  egg: "—è–π—Ü–∞"
};
function setSide(s){side=s;localStorage.side=s;renderButtons();renderMeals();}
function renderButtons(){
  ["rice","pasta","buckwheat"].forEach(s=>{
    document.getElementById("btn-"+s).classList.toggle("active",side===s);
  });
}
renderButtons();

const FOOD={
 chicken:{cal:165,prot:31,carb:0},
 rice:{cal:130,prot:2.7,carb:28},
 pasta:{cal:150,prot:5,carb:30},
 buckwheat:{cal:110,prot:4,carb:21},
 egg:{cal:70,prot:6,carb:1}
};

function getPlan(){
  return isTrainDay ? [
    ["–ó–∞–≤—Ç—Ä–∞–∫",[["rice",300],["egg",4]]],
    ["–ü–µ—Ä–µ–∫—É—Å",[["rice",250],["egg",2]]],
    ["–û–±–µ–¥",[["chicken",180],[side,350]]],
    ["–ü–µ—Ä–µ–¥ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–æ–π",[["rice",200],["egg",2]]],
    ["–£–∂–∏–Ω",[["chicken",150],[side,250]]]
  ] : [
    ["–ó–∞–≤—Ç—Ä–∞–∫",[["rice",250],["egg",4]]],
    ["–ü–µ—Ä–µ–∫—É—Å",[["rice",200],["egg",2]]],
    ["–û–±–µ–¥",[["chicken",180],[side,300]]],
    ["–£–∂–∏–Ω",[["chicken",150],[side,250]]]
  ];
}

function renderMeals(){
  let total = { cal:0, prot:0, carb:0 };
  meals.innerHTML = "";

  const plan = getPlan();

  plan.forEach((meal, i) => {
    meals.innerHTML += `<div class="meal-title">${meal[0]}</div>`;

    meal[1].forEach((item, j) => {
      const product = item[0];
      const recommended = item[1];

      const key = `fact_${day}_${i}_${j}`;
      const actual = Number(localStorage[key] || 0);

      const f = FOOD[product];
      const factor = product === "egg" ? actual : actual / 100;

      total.cal  += f.cal  * factor;
      total.prot += f.prot * factor;
      total.carb += f.carb * factor;

      meals.innerHTML += `
        <div class="food-row">
          <div class="food-name">${FOOD_NAMES[product]}</div>

          <div class="food-rec">
            —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: ${recommended} ${product==="egg" ? "—à—Ç" : "–≥"}
          </div>

          <input class="food-input"
            type="number"
            min="0"
            placeholder="0"
            value="${actual || ""}"
            onchange="
              localStorage['${key}'] = this.value || 0;
              renderMeals();
            ">

          <div class="food-rec">
            ${product==="egg" ? "—à—Ç" : "–≥"}
          </div>
        </div>
      `;
    });
  });

  // ===== –ü–†–û–ì–†–ï–°–°-–ë–ê–†–´ =====
  calFill.style.width  = Math.min(100, total.cal  / TARGETS.cal  * 100) + "%";
  protFill.style.width = Math.min(100, total.prot / TARGETS.prot * 100) + "%";
  carbFill.style.width = Math.min(100, total.carb / TARGETS.carb * 100) + "%";

  calText.innerText  = `${Math.round(total.cal)} / ${TARGETS.cal} –∫–∫–∞–ª`;
  protText.innerText = `${Math.round(total.prot)} / ${TARGETS.prot} –≥ –±–µ–ª–∫–∞`;
  carbText.innerText = `${Math.round(total.carb)} / ${TARGETS.carb} –≥ —É–≥–ª–µ–≤–æ–¥–æ–≤`;

  // ===== –ê–í–¢–û–°–û–í–ï–¢ =====
  const adviceEl = document.getElementById("advice");
  if (adviceEl) {
    adviceEl.innerText = "";

    const carbLeft = TARGETS.carb - total.carb;
    const protLeft = TARGETS.prot - total.prot;

    if (carbLeft > 20) {
      const grams = Math.round(carbLeft / FOOD[side].carb * 100);
      adviceEl.innerText =
        `üß† –û—Å—Ç–∞–ª–æ—Å—å –¥–æ–±—Ä–∞—Ç—å ${Math.round(carbLeft)} –≥ —É–≥–ª–µ–≤–æ–¥–æ–≤ ‚Äî –¥–æ–±–∞–≤—å ‚âà${grams} –≥ ${sides[side]}`;
    } 
    else if (protLeft > 15) {
      const grams = Math.round(protLeft / FOOD.chicken.prot * 100);
      adviceEl.innerText =
        `üß† –û—Å—Ç–∞–ª–æ—Å—å –¥–æ–±—Ä–∞—Ç—å ${Math.round(protLeft)} –≥ –±–µ–ª–∫–∞ ‚Äî –¥–æ–±–∞–≤—å ‚âà${grams} –≥ –∫—É—Ä–∏—Ü—ã`;
    }
  }
}

// ==================== –í–ï–° / –§–û–¢–û ====================
function saveWeight(){
 const w=document.getElementById("weightInput").value;
 if(!w)return;
 const data=JSON.parse(localStorage.weightLog||"[]");
 data.push({date:new Date().toLocaleDateString(),weight:w});
 localStorage.weightLog=JSON.stringify(data);
 renderProgress();
}
function savePhoto(e){
 const r=new FileReader();
 r.onload=()=>{
  const d=JSON.parse(localStorage.photoLog||"[]");
  d.push({date:new Date().toLocaleDateString(),img:r.result});
  localStorage.photoLog=JSON.stringify(d);
  renderProgress();
 };
 r.readAsDataURL(e.target.files[0]);
}
function renderProgress(){
 const w=JSON.parse(localStorage.weightLog||"[]");
 const p=JSON.parse(localStorage.photoLog||"[]");
 progressHistory.innerHTML="";
 w.forEach((x,i)=>{
  progressHistory.innerHTML+=`
   <div class="small">${x.date} ‚Äî ${x.weight} –∫–≥</div>
   ${p[i]?`<img src="${p[i].img}">`:""}`;
 });
}
renderProgress();

// ==================== –ù–ï–î–ï–õ–ò ====================
function renderWeekly(){
 const data=JSON.parse(localStorage.weightLog||"[]");
 weekly.innerHTML="";
 for(let i=0;i<data.length;i+=7){
  weekly.innerHTML+=`
   <div class="small">
    –ù–µ–¥–µ–ª—è ${Math.floor(i/7)+1}: –≤–µ—Å ${data[i]?.weight||"-"} –∫–≥
   </div>`;
 }
}
renderWeekly();

// ==================== –ù–ê–ü–û–ú–ò–ù–ê–ù–ò–Ø ====================
const TIMES=["08:00","11:00","14:00","17:00","19:00","21:00"];
let interval=null;
function enableReminders(){
 Notification.requestPermission();
 localStorage.reminders="on";
 interval=setInterval(()=>{
  if(localStorage.reminders!=="on")return;
  const t=new Date().toTimeString().slice(0,5);
  if(TIMES.includes(t))
   new Notification("üçΩÔ∏è –ü–û–†–ê –î–ï–õ–ê–¢–¨",{body:"NewMe –∂–¥—ë—Ç"});
 },60000);
}
function disableReminders(){
 localStorage.reminders="off";
 if(interval)clearInterval(interval);
}

// ==================== –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø ====================
function exportData(){
 const blob=new Blob([JSON.stringify(localStorage,null,2)],{type:"application/json"});
 const a=document.createElement("a");
 a.href=URL.createObjectURL(blob);
 a.download="newme_backup.json";
 a.click();
}
function importData(e){
 const r=new FileReader();
 r.onload=()=>{
  const d=JSON.parse(r.result);
  Object.keys(d).forEach(k=>localStorage[k]=d[k]);
  location.reload();
 };
 r.readAsText(e.target.files[0]);
}
</script>

</body>
</html>
